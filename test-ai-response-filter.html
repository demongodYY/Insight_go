<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AIå›ç­”è¿‡æ»¤æµ‹è¯•</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .test-section {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .test-button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    .test-button:hover {
      background: #0056b3;
    }
    .test-button.success {
      background: #28a745;
    }
    .test-button.success:hover {
      background: #218838;
    }
    .test-button.warning {
      background: #ffc107;
      color: #212529;
    }
    .test-button.warning:hover {
      background: #e0a800;
    }
    .status {
      margin: 10px 0;
      padding: 10px;
      border-radius: 4px;
      background: #e9ecef;
    }
    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .status.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    .status.warning {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }
    .log {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 10px;
      margin: 10px 0;
      max-height: 400px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 12px;
    }
    .message-container {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 15px;
      margin: 20px 0;
    }
    .user-message {
      background: #e3f2fd;
      border: 1px solid #2196f3;
      border-radius: 4px;
      padding: 10px;
      margin: 10px 0;
      position: relative;
    }
    .user-message::before {
      content: "ğŸ‘¤ ç”¨æˆ·æ¶ˆæ¯";
      position: absolute;
      top: -8px;
      left: 10px;
      background: #2196f3;
      color: white;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 10px;
    }
    .ai-response {
      background: #f3e5f5;
      border: 1px solid #9c27b0;
      border-radius: 4px;
      padding: 10px;
      margin: 10px 0;
      position: relative;
    }
    .ai-response::before {
      content: "ğŸ¤– AIå›ç­”";
      position: absolute;
      top: -8px;
      left: 10px;
      background: #9c27b0;
      color: white;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 10px;
    }
    .message-content {
      margin-top: 15px;
    }
    .code-block {
      background: #f5f5f5;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      font-family: monospace;
      margin: 10px 0;
    }
    .markdown-content {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 10px;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <h1>AIå›ç­”è¿‡æ»¤æµ‹è¯•</h1>
  
  <div class="test-section">
    <h2>æµ‹è¯•è¯´æ˜</h2>
    <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•æ’ä»¶çš„AIå›ç­”è¿‡æ»¤åŠŸèƒ½ã€‚ç°åœ¨æ’ä»¶åº”è¯¥èƒ½å¤Ÿï¼š</p>
    <ol>
      <li>æ­£ç¡®è¯†åˆ«ç”¨æˆ·æ¶ˆæ¯å’ŒAIå›ç­”</li>
      <li>åªå¤„ç†ç”¨æˆ·æ¶ˆæ¯ï¼Œè·³è¿‡AIå›ç­”</li>
      <li>é¿å…AIå›ç­”æ—¶é‡å¤æå–é—®é¢˜</li>
    </ol>
  </div>
  
  <div class="test-section">
    <h2>æ¨¡æ‹Ÿæ¶ˆæ¯å…ƒç´ </h2>
    <div class="message-container">
      <h3>DeepSeek å¹³å°æ¶ˆæ¯</h3>
      
      <div class="user-message" id="deepseek-user">
        <div class="message-content">
          <div class="fbb737a4">è¿™æ˜¯ä¸€ä¸ªç”¨æˆ·é—®é¢˜ï¼š8+1ç­‰äºå¤šå°‘ï¼Ÿ</div>
        </div>
      </div>
      
      <div class="ai-response" id="deepseek-ai">
        <div class="message-content">
          <div class="ds-markdown-paragraph">
            <p>8+1ç­‰äº9ã€‚</p>
            <div class="code-block">
              <code>8 + 1 = 9</code>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="message-container">
      <h3>Kimi å¹³å°æ¶ˆæ¯</h3>
      
      <div class="user-message" id="kimi-user">
        <div class="message-content">
          <div class="user-content">è¿™æ˜¯å¦ä¸€ä¸ªç”¨æˆ·é—®é¢˜ï¼šä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ</div>
        </div>
      </div>
      
      <div class="ai-response" id="kimi-ai">
        <div class="message-content">
          <div class="markdown-body">
            <p>äººå·¥æ™ºèƒ½ï¼ˆAIï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªåˆ†æ”¯...</p>
            <div class="code-block">
              <code>AI = Artificial Intelligence</code>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="test-section">
    <h2>æ“ä½œæŒ‰é’®</h2>
    <button class="test-button" onclick="testDeepSeekUser()">æµ‹è¯•DeepSeekç”¨æˆ·æ¶ˆæ¯</button>
    <button class="test-button" onclick="testDeepSeekAI()">æµ‹è¯•DeepSeek AIå›ç­”</button>
    <button class="test-button" onclick="testKimiUser()">æµ‹è¯•Kimiç”¨æˆ·æ¶ˆæ¯</button>
    <button class="test-button" onclick="testKimiAI()">æµ‹è¯•Kimi AIå›ç­”</button>
    <button class="test-button" onclick="testGenericMessage()">æµ‹è¯•é€šç”¨æ¶ˆæ¯</button>
    <button class="test-button" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
  </div>
  
  <div class="test-section">
    <h2>å½“å‰çŠ¶æ€</h2>
    <div id="status" class="status">ç­‰å¾…æ“ä½œ...</div>
  </div>
  
  <div class="test-section">
    <h2>æ“ä½œæ—¥å¿—</h2>
    <div id="log" class="log"></div>
  </div>
  
  <script>
    // æ¨¡æ‹Ÿæ’ä»¶çš„æ¶ˆæ¯æ£€æµ‹é€»è¾‘
    const config = {
      userMessageSelector: '.fbb737a4, .user-content, .chat-item-content',
      inputSelectors: ['textarea', '[contenteditable="true"]'],
      submitSelectors: ['button[type="submit"]']
    };
    
    // æ—¥å¿—å‡½æ•°
    function log(message, type = 'info') {
      const logElement = document.getElementById('log');
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement('div');
      logEntry.innerHTML = `[${timestamp}] ${message}`;
      logEntry.style.color = type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : type === 'warning' ? '#ffc107' : '#6c757d';
      logElement.appendChild(logEntry);
      logElement.scrollTop = logElement.scrollHeight;
      console.log(`[${timestamp}] ${message}`);
    }
    
    // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
    function updateStatus(message, type = 'info') {
      const statusElement = document.getElementById('status');
      statusElement.textContent = message;
      statusElement.className = `status ${type}`;
    }
    
    // æ£€æŸ¥æ˜¯å¦æ˜¯AIå›ç­”
    function isAIResponse(messageElement) {
      const hostname = 'deepseek.com'; // æ¨¡æ‹ŸDeepSeekç¯å¢ƒ
      
      // å¯¹äºdeepseekï¼Œæ£€æŸ¥æ˜¯å¦åŒ…å«AIå›ç­”çš„ç‰¹å¾
      if (messageElement.querySelector('.ds-markdown-paragraph')) {
        return true;
      }
      
      if (messageElement.querySelector('.markdown')) {
        return true;
      }
      
      if (messageElement.querySelector('pre, code')) {
        return true;
      }
      
      // æ£€æŸ¥æ˜¯å¦åŒ…å«AIå›ç­”çš„ç‰¹å®šå±æ€§æˆ–ç±»å
      if (messageElement.hasAttribute('data-role') && messageElement.getAttribute('data-role') === 'assistant') {
        return true;
      }
      
      // æ£€æŸ¥æ˜¯å¦åŒ…å«AIå›ç­”çš„ç‰¹å®šç±»å
      if (messageElement.classList.contains('assistant') || messageElement.classList.contains('ai-response')) {
        return true;
      }
      
      // æ£€æŸ¥æ˜¯å¦åŒ…å«AIå›ç­”çš„ç‰¹å®šç»“æ„ï¼ˆéç”¨æˆ·æ¶ˆæ¯çš„ç‰¹å¾ï¼‰
      if (messageElement.querySelector('.ds-markdown-paragraph, .markdown, pre, code')) {
        return true;
      }
      
      // é€šç”¨æ£€æµ‹ï¼šå¦‚æœåŒ…å«ä»£ç å—ã€markdownç­‰ç‰¹å¾ï¼Œè®¤ä¸ºæ˜¯AIå›ç­”
      if (messageElement.querySelector('pre, code, .markdown, .markdown-body')) {
        return true;
      }
      
      // æ£€æŸ¥æ˜¯å¦åŒ…å«AIå›ç­”çš„é€šç”¨ç‰¹å¾
      if (messageElement.hasAttribute('data-role') && messageElement.getAttribute('data-role') === 'assistant') {
        return true;
      }
      
      // æ£€æŸ¥æ˜¯å¦åŒ…å«AIå›ç­”çš„é€šç”¨ç±»å
      if (messageElement.classList.contains('assistant') || messageElement.classList.contains('ai-response') || 
          messageElement.classList.contains('bot') || messageElement.classList.contains('gpt')) {
        return true;
      }
      
      return false;
    }
    
    // æ£€æŸ¥æ˜¯å¦æ˜¯ç”¨æˆ·æ¶ˆæ¯
    function isUserMessage(messageElement) {
      const hostname = 'deepseek.com'; // æ¨¡æ‹ŸDeepSeekç¯å¢ƒ
      
      // å¯¹äºdeepseekï¼Œæ£€æŸ¥æ˜¯å¦åŒ…å«ç”¨æˆ·æ¶ˆæ¯çš„ç‰¹å¾
      if (messageElement.classList.contains('fbb737a4')) {
        return true;
      }
      
      if (messageElement.hasAttribute('data-role') && messageElement.getAttribute('data-role') === 'user') {
        return true;
      }
      
      if (messageElement.classList.contains('user') || messageElement.classList.contains('user-message')) {
        return true;
      }
      
      if (messageElement.querySelector('.user-content, .user-message')) {
        return true;
      }
      
      // é€šç”¨æ£€æµ‹ï¼šæ£€æŸ¥æ˜¯å¦åŒ…å«ç”¨æˆ·æ¶ˆæ¯çš„é€šç”¨ç‰¹å¾
      if (messageElement.hasAttribute('data-role') && messageElement.getAttribute('data-role') === 'user') {
        return true;
      }
      
      if (messageElement.classList.contains('user') || messageElement.classList.contains('user-message') || 
          messageElement.classList.contains('user-content')) {
        return true;
      }
      
      if (messageElement.querySelector('.user-content, .user-message, .user')) {
        return true;
      }
      
      return false;
    }
    
    // æ¨¡æ‹ŸprocessUserMessageæ–¹æ³•
    function processUserMessage(messageElement) {
      log(`å¼€å§‹å¤„ç†æ¶ˆæ¯å…ƒç´ : ${messageElement.id}`);
      
      // æ£€æŸ¥æ˜¯å¦æ˜¯AIå›ç­”ï¼Œå¦‚æœæ˜¯åˆ™è·³è¿‡å¤„ç†
      if (isAIResponse(messageElement)) {
        log('æ£€æµ‹åˆ°AIå›ç­”ï¼Œè·³è¿‡å¤„ç†', 'warning');
        return;
      }
      
      // é¢å¤–æ£€æŸ¥ï¼šå¦‚æœæ¶ˆæ¯å…ƒç´ åŒ…å«ç”¨æˆ·æ¶ˆæ¯çš„ç‰¹å¾ï¼Œåˆ™è®¤ä¸ºæ˜¯ç”¨æˆ·æ¶ˆæ¯
      if (isUserMessage(messageElement)) {
        log('ç¡®è®¤æ˜¯ç”¨æˆ·æ¶ˆæ¯ï¼Œç»§ç»­å¤„ç†', 'success');
      } else {
        log('æ— æ³•ç¡®å®šæ¶ˆæ¯ç±»å‹ï¼Œè·³è¿‡å¤„ç†', 'warning');
        return;
      }
      
      // æå–æ¶ˆæ¯æ–‡æœ¬
      const messageText = messageElement.textContent || messageElement.innerText;
      if (!messageText || !messageText.trim()) {
        log('æ¶ˆæ¯æ–‡æœ¬ä¸ºç©ºï¼Œè·³è¿‡å¤„ç†', 'warning');
        return;
      }
      
      log(`å‡†å¤‡å¤„ç†ç”¨æˆ·æ¶ˆæ¯: ${messageText.substring(0, 50)}...`, 'success');
      log(`æ¶ˆæ¯å…ƒç´ ID: ${messageElement.id}`, 'info');
      log(`æ¶ˆæ¯å…ƒç´ ç±»å: ${messageElement.className}`, 'info');
    }
    
    // æµ‹è¯•DeepSeekç”¨æˆ·æ¶ˆæ¯
    function testDeepSeekUser() {
      log('=== æµ‹è¯•DeepSeekç”¨æˆ·æ¶ˆæ¯ ===', 'info');
      const userElement = document.getElementById('deepseek-user');
      processUserMessage(userElement);
      updateStatus('DeepSeekç”¨æˆ·æ¶ˆæ¯æµ‹è¯•å®Œæˆ', 'success');
    }
    
    // æµ‹è¯•DeepSeek AIå›ç­”
    function testDeepSeekAI() {
      log('=== æµ‹è¯•DeepSeek AIå›ç­” ===', 'info');
      const aiElement = document.getElementById('deepseek-ai');
      processUserMessage(aiElement);
      updateStatus('DeepSeek AIå›ç­”æµ‹è¯•å®Œæˆ', 'success');
    }
    
    // æµ‹è¯•Kimiç”¨æˆ·æ¶ˆæ¯
    function testKimiUser() {
      log('=== æµ‹è¯•Kimiç”¨æˆ·æ¶ˆæ¯ ===', 'info');
      const userElement = document.getElementById('kimi-user');
      processUserMessage(userElement);
      updateStatus('Kimiç”¨æˆ·æ¶ˆæ¯æµ‹è¯•å®Œæˆ', 'success');
    }
    
    // æµ‹è¯•Kimi AIå›ç­”
    function testKimiAI() {
      log('=== æµ‹è¯•Kimi AIå›ç­” ===', 'info');
      const aiElement = document.getElementById('kimi-ai');
      processUserMessage(aiElement);
      updateStatus('Kimi AIå›ç­”æµ‹è¯•å®Œæˆ', 'success');
    }
    
    // æµ‹è¯•é€šç”¨æ¶ˆæ¯
    function testGenericMessage() {
      log('=== æµ‹è¯•é€šç”¨æ¶ˆæ¯ ===', 'info');
      
      // åˆ›å»ºä¸€ä¸ªé€šç”¨çš„æ¶ˆæ¯å…ƒç´ 
      const genericElement = document.createElement('div');
      genericElement.id = 'generic-message';
      genericElement.className = 'generic-message';
      genericElement.textContent = 'è¿™æ˜¯ä¸€ä¸ªé€šç”¨æ¶ˆæ¯ï¼Œæ²¡æœ‰ç‰¹å®šçš„ç‰¹å¾';
      
      processUserMessage(genericElement);
      updateStatus('é€šç”¨æ¶ˆæ¯æµ‹è¯•å®Œæˆ', 'success');
    }
    
    // æ¸…ç©ºæ—¥å¿—
    function clearLog() {
      document.getElementById('log').innerHTML = '';
      log('æ—¥å¿—å·²æ¸…ç©º');
    }
    
    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    window.addEventListener('load', () => {
      log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹æµ‹è¯•AIå›ç­”è¿‡æ»¤åŠŸèƒ½');
      updateStatus('å‡†å¤‡æµ‹è¯•AIå›ç­”è¿‡æ»¤åŠŸèƒ½', 'info');
    });
  </script>
</body>
</html>
