<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç»Ÿä¸€é‡å¤é—®é¢˜é¢„é˜²æµ‹è¯•</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .test-section {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .test-button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    .test-button:hover {
      background: #0056b3;
    }
    .test-button.success {
      background: #28a745;
    }
    .test-button.success:hover {
      background: #218838;
    }
    .test-button.warning {
      background: #ffc107;
      color: #212529;
    }
    .test-button.warning:hover {
      background: #e0a800;
    }
    .status {
      margin: 10px 0;
      padding: 10px;
      border-radius: 4px;
      background: #e9ecef;
    }
    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .status.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    .status.warning {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }
    .log {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 10px;
      margin: 10px 0;
      max-height: 400px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 12px;
    }
    .question-list {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 10px;
      margin: 10px 0;
      max-height: 300px;
      overflow-y: auto;
    }
    .question-item {
      background: white;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 8px;
      margin: 5px 0;
      font-size: 12px;
    }
    .question-id {
      color: #6c757d;
      font-weight: bold;
    }
    .question-text {
      color: #495057;
      margin: 5px 0;
    }
    .question-time {
      color: #6c757d;
      font-size: 10px;
    }
    .input-area {
      background: white;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 15px;
      margin: 20px 0;
    }
    .input-box {
      width: 100%;
      padding: 10px;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      font-size: 14px;
      margin-bottom: 10px;
    }
    .submit-btn {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
    }
    .submit-btn:hover {
      background: #0056b3;
    }
    .message-container {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 15px;
      margin: 20px 0;
    }
    .platform-section {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #dee2e6;
      border-radius: 4px;
    }
    .deepseek-message {
      background: #e3f2fd;
      border: 1px solid #2196f3;
      border-radius: 4px;
      padding: 10px;
      margin: 10px 0;
      position: relative;
    }
    .deepseek-message::before {
      content: "ğŸ”µ DeepSeekç”¨æˆ·æ¶ˆæ¯";
      position: absolute;
      top: -8px;
      left: 10px;
      background: #2196f3;
      color: white;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 10px;
    }
    .doubao-message {
      background: #e8f5e8;
      border: 1px solid #4caf50;
      border-radius: 4px;
      padding: 10px;
      margin: 10px 0;
      position: relative;
    }
    .doubao-message::before {
      content: "ğŸŸ¢ è±†åŒ…ç”¨æˆ·æ¶ˆæ¯";
      position: absolute;
      top: -8px;
      left: 10px;
      background: #4caf50;
      color: white;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 10px;
    }
    .kimi-message {
      background: #fff3e0;
      border: 1px solid #ff9800;
      border-radius: 4px;
      padding: 10px;
      margin: 10px 0;
      position: relative;
    }
    .kimi-message::before {
      content: "ğŸŸ  Kimiç”¨æˆ·æ¶ˆæ¯";
      position: absolute;
      top: -8px;
      left: 10px;
      background: #ff9800;
      color: white;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 10px;
    }
    .ai-response {
      background: #f3e5f5;
      border: 1px solid #9c27b0;
      border-radius: 4px;
      padding: 10px;
      margin: 10px 0;
      position: relative;
    }
    .ai-response::before {
      content: "ğŸ¤– AIå›ç­”";
      position: absolute;
      top: -8px;
      left: 10px;
      background: #9c27b0;
      color: white;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 10px;
    }
  </style>
</head>
<body>
  <h1>ç»Ÿä¸€é‡å¤é—®é¢˜é¢„é˜²æµ‹è¯•</h1>
  
  <div class="test-section">
    <h2>æµ‹è¯•è¯´æ˜</h2>
    <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•æ’ä»¶çš„ç»Ÿä¸€é‡å¤é—®é¢˜é¢„é˜²åŠŸèƒ½ã€‚ç°åœ¨æ’ä»¶åº”è¯¥èƒ½å¤Ÿï¼š</p>
    <ol>
      <li>åœ¨æ‰€æœ‰å¹³å°ä¸Šæ­£ç¡®è¯†åˆ«ç”¨æˆ·æ¶ˆæ¯å’ŒAIå›ç­”</li>
      <li>é¿å…åŒä¸€ä¸ªé—®é¢˜è¢«é‡å¤æå–ï¼ˆ5ç§’å†…ï¼‰</li>
      <li>å…è®¸ç›¸åŒå†…å®¹çš„é—®é¢˜è¢«è®°å½•ï¼ˆ5ç§’åï¼‰</li>
      <li>ä½¿ç”¨ç»Ÿä¸€çš„é‡å¤é¢„é˜²æœºåˆ¶</li>
    </ol>
  </div>
  
  <div class="test-section">
    <h2>æ¨¡æ‹Ÿå„å¹³å°æ¶ˆæ¯å…ƒç´ </h2>
    
    <div class="platform-section">
      <h3>DeepSeek å¹³å°æ¶ˆæ¯ç»“æ„</h3>
      <div class="deepseek-message" id="deepseek-user-1">
        <div class="fbb737a4">è¿™æ˜¯DeepSeekç”¨æˆ·é—®é¢˜ï¼šä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ</div>
      </div>
      <div class="ai-response" id="deepseek-ai-1">
        <div class="ds-markdown-paragraph">
          <p>äººå·¥æ™ºèƒ½ï¼ˆAIï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªåˆ†æ”¯...</p>
          <pre><code>AI = Artificial Intelligence</code></pre>
        </div>
      </div>
    </div>
    
    <div class="platform-section">
      <h3>è±†åŒ… å¹³å°æ¶ˆæ¯ç»“æ„</h3>
      <div class="doubao-message" id="doubao-user-1">
        <div data-testid="message_text_content" class="container-ZzKwSY bg-s-color-bg-trans rounded-s-radius-s text-s-color-text-primary">
          è¿™æ˜¯è±†åŒ…ç”¨æˆ·é—®é¢˜ï¼šå¦‚ä½•å­¦ä¹ ç¼–ç¨‹ï¼Ÿ
        </div>
      </div>
      <div class="ai-response" id="doubao-ai-1">
        <div class="markdown">
          <p>å­¦ä¹ ç¼–ç¨‹éœ€è¦æŒæ¡åŸºç¡€çŸ¥è¯†...</p>
          <pre><code>console.log("Hello World");</code></pre>
        </div>
      </div>
    </div>
    
    <div class="platform-section">
      <h3>Kimi å¹³å°æ¶ˆæ¯ç»“æ„</h3>
      <div class="kimi-message" id="kimi-user-1">
        <div class="user-content">è¿™æ˜¯Kimiç”¨æˆ·é—®é¢˜ï¼šä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ</div>
      </div>
      <div class="ai-response" id="kimi-ai-1">
        <div class="markdown-body">
          <p>æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªå­é¢†åŸŸ...</p>
          <pre><code>ML = Machine Learning</code></pre>
        </div>
      </div>
    </div>
  </div>
  
  <div class="test-section">
    <h2>æ¨¡æ‹Ÿé—®é¢˜è¾“å…¥</h2>
    <div class="input-area">
      <textarea class="input-box" id="questionInput" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜..."></textarea>
      <button class="submit-btn" onclick="submitQuestion()">æäº¤é—®é¢˜</button>
    </div>
  </div>
  
  <div class="test-section">
    <h2>æ“ä½œæŒ‰é’®</h2>
    <button class="test-button" onclick="testAllPlatforms()">æµ‹è¯•æ‰€æœ‰å¹³å°æ¶ˆæ¯è¯†åˆ«</button>
    <button class="test-button" onclick="simulateDOMChange()">æ¨¡æ‹ŸDOMå˜åŒ–</button>
    <button class="test-button" onclick="simulateChatSwitch()">æ¨¡æ‹Ÿå¯¹è¯åˆ‡æ¢</button>
    <button class="test-button" onclick="addSameQuestion()">æ·»åŠ ç›¸åŒé—®é¢˜</button>
    <button class="test-button" onclick="addSameQuestionAfterDelay()">5ç§’åæ·»åŠ ç›¸åŒé—®é¢˜</button>
    <button class="test-button" onclick="checkQuestions()">æ£€æŸ¥é—®é¢˜åˆ—è¡¨</button>
    <button class="test-button" onclick="clearQuestions()">æ¸…ç©ºé—®é¢˜åˆ—è¡¨</button>
    <button class="test-button" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
  </div>
  
  <div class="test-section">
    <h2>å½“å‰çŠ¶æ€</h2>
    <div id="status" class="status">ç­‰å¾…æ“ä½œ...</div>
  </div>
  
  <div class="test-section">
    <h2>é—®é¢˜åˆ—è¡¨</h2>
    <div id="question-list" class="question-list">
      <p>æš‚æ— é—®é¢˜</p>
    </div>
  </div>
  
  <div class="test-section">
    <h2>æ“ä½œæ—¥å¿—</h2>
    <div id="log" class="log"></div>
  </div>
  
  <script>
    // æ¨¡æ‹Ÿæ’ä»¶çš„é—®é¢˜ç®¡ç†
    let questions = [];
    let questionCounter = 1;
    let pendingQuestionText = null;
    let pendingQuestionTimestamp = null;
    let recentlyProcessedQuestions = null;
    
    // æ—¥å¿—å‡½æ•°
    function log(message, type = 'info') {
      const logElement = document.getElementById('log');
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement('div');
      logEntry.innerHTML = `[${timestamp}] ${message}`;
      logEntry.style.color = type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : type === 'warning' ? '#ffc107' : '#6c757d';
      logElement.appendChild(logEntry);
      logElement.scrollTop = logElement.scrollHeight;
      console.log(`[${timestamp}] ${message}`);
    }
    
    // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
    function updateStatus(message, type = 'info') {
      const statusElement = document.getElementById('status');
      statusElement.textContent = message;
      statusElement.className = `status ${type}`;
    }
    
    // ç”Ÿæˆé—®é¢˜ID
    function generateQuestionId() {
      const timestamp = Date.now();
      const randomPart = Math.random().toString(36).substr(2, 9);
      return `act-nav-${timestamp}-${randomPart}`;
    }
    
    // æˆªæ–­æ–‡æœ¬
    function truncateText(text, maxLength) {
      if (text.length <= maxLength) return text;
      return text.substring(0, maxLength) + '...';
    }
    
    // æ£€æŸ¥æ˜¯å¦æ˜¯AIå›ç­”ï¼ˆæ‰€æœ‰å¹³å°ï¼‰
    function isAIResponse(messageElement) {
      // æ£€æŸ¥æ˜¯å¦åŒ…å«AIå›ç­”çš„ç‰¹å¾
      if (messageElement.querySelector('.markdown, .markdown-body, .ds-markdown-paragraph')) {
        return true;
      }
      
      if (messageElement.querySelector('pre, code')) {
        return true;
      }
      
      if (messageElement.hasAttribute('data-role') && messageElement.getAttribute('data-role') === 'assistant') {
        return true;
      }
      
      return false;
    }
    
    // æ£€æŸ¥æ˜¯å¦æ˜¯ç”¨æˆ·æ¶ˆæ¯ï¼ˆæ‰€æœ‰å¹³å°ï¼‰
    function isUserMessage(messageElement) {
      // DeepSeekå¹³å°
      if (messageElement.classList.contains('fbb737a4')) {
        return true;
      }
      
      // è±†åŒ…å¹³å°
      if (messageElement.hasAttribute('data-testid') && messageElement.getAttribute('data-testid') === 'message_text_content') {
        return true;
      }
      
      // Kimiå¹³å°
      if (messageElement.classList.contains('user-content')) {
        return true;
      }
      
      // é€šç”¨æ£€æµ‹
      if (messageElement.hasAttribute('data-role') && messageElement.getAttribute('data-role') === 'user') {
        return true;
      }
      
      if (messageElement.classList.contains('user') || messageElement.classList.contains('user-message') || 
          messageElement.classList.contains('user-content') || messageElement.classList.contains('container-ZzKwSY')) {
        return true;
      }
      
      if (messageElement.querySelector('.user-content, .user-message, .user, .container-ZzKwSY')) {
        return true;
      }
      
      return false;
    }
    
    // æäº¤é—®é¢˜ï¼ˆæ¨¡æ‹ŸhandleQuestionSubmitï¼‰
    function submitQuestion() {
      const inputBox = document.getElementById('questionInput');
      const questionText = inputBox.value.trim();
      
      if (!questionText) {
        log('è¯·è¾“å…¥é—®é¢˜å†…å®¹', 'warning');
        return;
      }
      
      log(`å‡†å¤‡æ·»åŠ æ–°é—®é¢˜: ${questionText}`);
      
      // è®¾ç½®å¾…å¤„ç†æ ‡è®°ï¼Œé˜²æ­¢é‡å¤å¤„ç†
      pendingQuestionText = questionText;
      pendingQuestionTimestamp = Date.now();
      
      // æ¨¡æ‹Ÿå»¶è¿Ÿå¤„ç†
      setTimeout(() => {
        addQuestion(questionText);
        
        // æ¸…é™¤å¾…å¤„ç†æ ‡è®°
        pendingQuestionText = null;
        pendingQuestionTimestamp = null;
        
        // æ¸…ç©ºè¾“å…¥æ¡†
        inputBox.value = '';
      }, 100);
    }
    
    // æ¨¡æ‹ŸDOMå˜åŒ–ï¼ˆæ¨¡æ‹ŸprocessUserMessageï¼‰
    function simulateDOMChange() {
      const questionText = "è¿™æ˜¯é€šè¿‡DOMå˜åŒ–æ£€æµ‹åˆ°çš„é—®é¢˜";
      
      // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰å¾…å¤„ç†çš„é—®é¢˜ï¼Œé¿å…é‡å¤å¤„ç†
      if (pendingQuestionText && pendingQuestionTimestamp) {
        const timeDiff = Date.now() - pendingQuestionTimestamp;
        const textMatch = pendingQuestionText.trim() === questionText.trim();
        
        // å¦‚æœæ—¶é—´å·®å°äº2ç§’ä¸”æ–‡æœ¬åŒ¹é…ï¼Œè¯´æ˜è¿™æ˜¯åŒä¸€ä¸ªé—®é¢˜ï¼Œè·³è¿‡å¤„ç†
        if (timeDiff < 2000 && textMatch) {
          log(`è·³è¿‡é‡å¤å¤„ç†çš„é—®é¢˜: ${questionText} (å·²æœ‰å¾…å¤„ç†çš„é—®é¢˜)`, 'warning');
          return;
        }
      }
      
      // ç»Ÿä¸€çš„å¤šå¹³å°é‡å¤é¢„é˜²æœºåˆ¶ï¼šæ£€æŸ¥æœ€è¿‘æ˜¯å¦å·²ç»å¤„ç†è¿‡ç›¸åŒå†…å®¹çš„é—®é¢˜
      if (recentlyProcessedQuestions && recentlyProcessedQuestions.has(questionText.trim())) {
        const lastProcessedTime = recentlyProcessedQuestions.get(questionText.trim());
        const timeDiff = Date.now() - lastProcessedTime;
        
        // å¦‚æœ5ç§’å†…å·²ç»å¤„ç†è¿‡ç›¸åŒå†…å®¹çš„é—®é¢˜ï¼Œè·³è¿‡å¤„ç†
        if (timeDiff < 5000) {
          log(`è·³è¿‡æœ€è¿‘å·²å¤„ç†çš„é—®é¢˜: ${questionText} (${timeDiff}mså‰å¤„ç†è¿‡)`, 'warning');
          return;
        }
      }
      
      log(`å‡†å¤‡å¤„ç†ç”¨æˆ·æ¶ˆæ¯: ${questionText.substring(0, 50)}...`);
      addQuestion(questionText);
    }
    
    // æ¨¡æ‹Ÿå¯¹è¯åˆ‡æ¢
    function simulateChatSwitch() {
      log('æ¨¡æ‹Ÿå¯¹è¯åˆ‡æ¢...', 'warning');
      
      // ä¿å­˜å½“å‰é—®é¢˜åˆ°ä¼šè¯å­˜å‚¨
      if (questions.length > 0) {
        const sessionKey = 'act-nav-session-questions-old-chat';
        const questionsData = questions.map(q => ({
          id: q.id,
          text: q.text,
          fullText: q.fullText,
          timestamp: q.timestamp,
          chatId: 'old-chat'
        }));
        
        sessionStorage.setItem(sessionKey, JSON.stringify(questionsData));
        log(`ä¿å­˜æ—§å¯¹è¯çš„ ${questions.length} ä¸ªé—®é¢˜åˆ°ä¼šè¯å­˜å‚¨`, 'success');
      }
      
      // æ¸…ç©ºé—®é¢˜åˆ—è¡¨
      questions = [];
      
      // é‡ç½®é˜²æ­¢é‡å¤å¤„ç†çš„æ ‡è®°
      pendingQuestionText = null;
      pendingQuestionTimestamp = null;
      log('å¯¹è¯åˆ‡æ¢æ—¶å·²é‡ç½®é‡å¤å¤„ç†æ ‡è®°', 'success');
      
      // é‡ç½®é‡å¤å¤„ç†è®°å½•
      if (recentlyProcessedQuestions) {
        recentlyProcessedQuestions.clear();
        log('å¯¹è¯åˆ‡æ¢æ—¶å·²æ¸…ç©ºé‡å¤å¤„ç†è®°å½•', 'success');
      }
      
      // æ›´æ–°æ˜¾ç¤º
      updateQuestionList();
      updateStatus('å¯¹è¯å·²åˆ‡æ¢ï¼Œé—®é¢˜åˆ—è¡¨å·²æ¸…ç©º', 'success');
    }
    
    // æ·»åŠ ç›¸åŒå†…å®¹çš„é—®é¢˜
    function addSameQuestion() {
      const questionText = "è¿™æ˜¯ç›¸åŒå†…å®¹çš„é—®é¢˜";
      
      log(`å‡†å¤‡æ·»åŠ ç›¸åŒé—®é¢˜: ${questionText}`);
      addQuestion(questionText);
    }
    
    // 5ç§’åæ·»åŠ ç›¸åŒå†…å®¹çš„é—®é¢˜
    function addSameQuestionAfterDelay() {
      const questionText = "è¿™æ˜¯ç›¸åŒå†…å®¹çš„é—®é¢˜";
      
      log(`å‡†å¤‡5ç§’åæ·»åŠ ç›¸åŒé—®é¢˜: ${questionText}`);
      
      setTimeout(() => {
        log(`5ç§’åå°è¯•æ·»åŠ ç›¸åŒé—®é¢˜: ${questionText}`);
        
        // æ£€æŸ¥æ˜¯å¦æœ€è¿‘å·²ç»å¤„ç†è¿‡
        if (recentlyProcessedQuestions && recentlyProcessedQuestions.has(questionText.trim())) {
          const lastProcessedTime = recentlyProcessedQuestions.get(questionText.trim());
          const timeDiff = Date.now() - lastProcessedTime;
          
          if (timeDiff < 5000) {
            log(`è·³è¿‡æœ€è¿‘å·²å¤„ç†çš„é—®é¢˜: ${questionText} (${timeDiff}mså‰å¤„ç†è¿‡)`, 'warning');
            return;
          }
        }
        
        addQuestion(questionText);
      }, 5000);
    }
    
    // æ·»åŠ é—®é¢˜åˆ°åˆ—è¡¨
    function addQuestion(text) {
      const question = {
        id: generateQuestionId(),
        text: truncateText(text, 50),
        fullText: text,
        timestamp: Date.now(),
        chatId: 'test-chat'
      };
      
      questions.push(question);
      
      log(`é—®é¢˜å·²æ·»åŠ åˆ°ç›®å½•: ${question.id}`, 'success');
      updateStatus(`å·²æ·»åŠ ç¬¬ ${questions.length} ä¸ªé—®é¢˜`, 'success');
      
      // è®°å½•æœ€è¿‘å¤„ç†çš„é—®é¢˜ï¼Œé˜²æ­¢é‡å¤å¤„ç†ï¼ˆæ‰€æœ‰å¹³å°é€šç”¨ï¼‰
      if (!recentlyProcessedQuestions) {
        recentlyProcessedQuestions = new Map();
      }
      recentlyProcessedQuestions.set(text.trim(), Date.now());
      
      // æ¸…ç†è¶…è¿‡5ç§’çš„è®°å½•
      setTimeout(() => {
        if (recentlyProcessedQuestions) {
          const now = Date.now();
          for (const [text, timestamp] of recentlyProcessedQuestions.entries()) {
            if (now - timestamp > 5000) {
              recentlyProcessedQuestions.delete(text);
            }
          }
        }
      }, 5000);
      
      updateQuestionList();
    }
    
    // æµ‹è¯•æ‰€æœ‰å¹³å°æ¶ˆæ¯è¯†åˆ«
    function testAllPlatforms() {
      log('=== æµ‹è¯•æ‰€æœ‰å¹³å°æ¶ˆæ¯è¯†åˆ« ===', 'info');
      
      // æµ‹è¯•DeepSeek
      const deepseekElement = document.getElementById('deepseek-user-1');
      if (isUserMessage(deepseekElement)) {
        log('âœ… DeepSeekç”¨æˆ·æ¶ˆæ¯è¯†åˆ«æˆåŠŸ', 'success');
      } else {
        log('âŒ DeepSeekç”¨æˆ·æ¶ˆæ¯è¯†åˆ«å¤±è´¥', 'error');
      }
      
      // æµ‹è¯•è±†åŒ…
      const doubaoElement = document.getElementById('doubao-user-1');
      if (isUserMessage(doubaoElement)) {
        log('âœ… è±†åŒ…ç”¨æˆ·æ¶ˆæ¯è¯†åˆ«æˆåŠŸ', 'success');
      } else {
        log('âŒ è±†åŒ…ç”¨æˆ·æ¶ˆæ¯è¯†åˆ«å¤±è´¥', 'error');
      }
      
      // æµ‹è¯•Kimi
      const kimiElement = document.getElementById('kimi-user-1');
      if (isUserMessage(kimiElement)) {
        log('âœ… Kimiç”¨æˆ·æ¶ˆæ¯è¯†åˆ«æˆåŠŸ', 'success');
      } else {
        log('âŒ Kimiç”¨æˆ·æ¶ˆæ¯è¯†åˆ«å¤±è´¥', 'error');
      }
      
      // æµ‹è¯•AIå›ç­”
      const aiElement = document.getElementById('deepseek-ai-1');
      if (isAIResponse(aiElement)) {
        log('âœ… AIå›ç­”è¯†åˆ«æˆåŠŸ', 'success');
      } else {
        log('âŒ AIå›ç­”è¯†åˆ«å¤±è´¥', 'error');
      }
      
      updateStatus('æ‰€æœ‰å¹³å°æ¶ˆæ¯è¯†åˆ«æµ‹è¯•å®Œæˆ', 'success');
    }
    
    // æ£€æŸ¥é—®é¢˜åˆ—è¡¨
    function checkQuestions() {
      log(`æ£€æŸ¥é—®é¢˜åˆ—è¡¨ï¼Œå½“å‰å…±æœ‰ ${questions.length} ä¸ªé—®é¢˜`);
      
      if (questions.length === 0) {
        log('é—®é¢˜åˆ—è¡¨ä¸ºç©º');
        return;
      }
      
      // æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤å†…å®¹çš„é—®é¢˜
      const contentMap = new Map();
      let duplicateCount = 0;
      
      questions.forEach((q, index) => {
        if (contentMap.has(q.fullText)) {
          duplicateCount++;
          log(`å‘ç°é‡å¤å†…å®¹é—®é¢˜: ç´¢å¼• ${index} å’Œ ${contentMap.get(q.fullText)} å†…å®¹ç›¸åŒ`);
        } else {
          contentMap.set(q.fullText, index);
        }
      });
      
      if (duplicateCount > 0) {
        log(`å…±å‘ç° ${duplicateCount} ä¸ªé‡å¤å†…å®¹çš„é—®é¢˜`, 'success');
        updateStatus(`å‘ç° ${duplicateCount} ä¸ªé‡å¤å†…å®¹çš„é—®é¢˜ï¼ŒéªŒè¯äº†é‡å¤è®°å½•åŠŸèƒ½`, 'success');
      } else {
        log('æ²¡æœ‰å‘ç°é‡å¤å†…å®¹çš„é—®é¢˜');
        updateStatus('æ²¡æœ‰å‘ç°é‡å¤å†…å®¹çš„é—®é¢˜', 'info');
      }
    }
    
    // æ¸…ç©ºé—®é¢˜åˆ—è¡¨
    function clearQuestions() {
      questions = [];
      questionCounter = 1;
      
      // é‡ç½®é˜²æ­¢é‡å¤å¤„ç†çš„æ ‡è®°
      pendingQuestionText = null;
      pendingQuestionTimestamp = null;
      
      // é‡ç½®é‡å¤å¤„ç†è®°å½•
      if (recentlyProcessedQuestions) {
        recentlyProcessedQuestions.clear();
        log('é‡å¤å¤„ç†è®°å½•å·²æ¸…ç©º', 'success');
      }
      
      log('é—®é¢˜åˆ—è¡¨å·²æ¸…ç©ºï¼Œé‡å¤å¤„ç†æ ‡è®°å·²é‡ç½®', 'success');
      updateStatus('é—®é¢˜åˆ—è¡¨å·²æ¸…ç©º', 'success');
      updateQuestionList();
    }
    
    // æ›´æ–°é—®é¢˜åˆ—è¡¨æ˜¾ç¤º
    function updateQuestionList() {
      const questionListElement = document.getElementById('question-list');
      
      if (questions.length === 0) {
        questionListElement.innerHTML = '<p>æš‚æ— é—®é¢˜</p>';
        return;
      }
      
      questionListElement.innerHTML = questions.map((q, index) => `
        <div class="question-item">
          <div class="question-id">#${index + 1} - ${q.id}</div>
          <div class="question-text">${q.text}</div>
          <div class="question-time">${new Date(q.timestamp).toLocaleTimeString()}</div>
        </div>
      `).join('');
    }
    
    // æ¸…ç©ºæ—¥å¿—
    function clearLog() {
      document.getElementById('log').innerHTML = '';
      log('æ—¥å¿—å·²æ¸…ç©º');
    }
    
    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    window.addEventListener('load', () => {
      log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹æµ‹è¯•ç»Ÿä¸€é‡å¤é—®é¢˜é¢„é˜²åŠŸèƒ½');
      updateStatus('å‡†å¤‡æµ‹è¯•ç»Ÿä¸€é‡å¤é—®é¢˜é¢„é˜²åŠŸèƒ½', 'info');
    });
    
    // é¡µé¢å¸è½½å‰ä¿å­˜çŠ¶æ€
    window.addEventListener('beforeunload', () => {
      log('é¡µé¢å³å°†å¸è½½');
    });
  </script>
</body>
</html>
